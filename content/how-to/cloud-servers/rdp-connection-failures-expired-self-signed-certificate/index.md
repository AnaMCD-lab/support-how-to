---
permalink: /rdp-connection-failures-expired-self-signed-certificate/
audit_date: '2021-05-04'
title: 'RDP Connection Failures: Expired Self-Signed Certificate'
type: article
created_date: '2021-03-12'
created_by: Steven Mondragon-DeVoss
last_modified_date: '2021-05-04'
last_modified_by: Ana Corpus
product: Cloud Servers
product_url: cloud-servers
---

# Issue
Remote Desktop Protocol (RDP) connections begin to fail with no apparent cause.

# Symptoms
- The client can't connect to the server by using RDP. The connection attempt returns code **50331673**: _"The Remote Desktop Gateway server administrator has ended the connection"_.
- The system logs register **Event ID 36870** for every RPD connection attempt.

# Cause
- The RDP self-signed certificate has expired or is missing (Windows usually recreates the self-signed certificate upon expiration).
- Permissions issues on the following path: **C:\ProgramData\Microsoft\Crypto\RSA\MachineKeys\f686aace6942fb7f7ceb231212eef4a4**. The parent folder did not allow the OS to delete the existing key, which needs to be done before  recreating the self-signed certificate.


## Resolution
1. Delete the expired certificate from the Centralized Certificate Store (CCS) on the server by using the Certificates snap-in in the Microsoft Management Console (MMC). Select **Certificates > Remote Desktop > Certificates**.

2. Stop the RDP service.

3. Go to path  **C:\ProgramData\Microsoft\Crypto\RSA\MachineKeys**. Take ownership of the **f686** key file, referenced above. Give the owner of the file _Full Control_ permissions.

4. Change the _Administrators_ group permissions of the **MachineKeys** folder to _apply to "This folder, subfolders and files"_.

5. Delete file **f686aace6942fb7f7ceb231212eef4a4**.

6. Start the **Remote Desktop Services** service.

7. Verify that a new certificate has been generated by using the **Certificates** snap-in in MMC.

8. Verify RDP access to the server.

Use the Feedback tab to make any comments or ask questions. You can also click
**Let's Talk** to [start the conversation](https://www.rackspace.com/).